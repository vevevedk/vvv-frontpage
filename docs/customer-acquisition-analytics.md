# Customer Acquisition Analytics Feature

## Overview
The Customer Acquisition Analytics feature provides comprehensive insights into new customer acquisition, customer retention patterns, and Customer Acquisition Cost (CAC) metrics for WooCommerce stores.

## Key Features

### 1. New Customer Identification
- **Configurable Window**: Define what constitutes a "new customer" based on days since last purchase (default: 365 days)
- **Smart Detection**: Automatically identifies:
  - First-time customers (never ordered before)
  - Re-activated customers (no purchase within the configured window)
- **Email-based Tracking**: Uses customer email as the unique identifier

### 2. Core Metrics

#### Overview Statistics
- **New Customers**: Count of unique new customers in the period
- **Returning Customers**: Count of unique returning customers
- **New Customer Percentage**: Ratio of new to total customers
- **Revenue Split**: Revenue from new vs returning customers
- **Average Order Values**: Separate AOV for new and returning customers

#### Growth Metrics
- **Period-over-Period Comparison**: Compare new customer acquisition with previous period
- **Growth Rate**: Percentage change in new customer acquisition
- **Trend Analysis**: Daily trends for new customer acquisition

### 3. CAC (Customer Acquisition Cost) Framework
The feature includes a framework for CAC tracking with placeholders for marketing spend integration:
- **Total Marketing Spend**: To be integrated with ad platforms
- **CAC Calculation**: Marketing spend ÷ New customers
- **Revenue per New Customer**: Average revenue generated by each new customer
- **CAC Payback Ratio**: Revenue ÷ Marketing spend

> **Note**: Marketing spend data needs to be integrated from advertising platforms (Google Ads, Facebook Ads, etc.)

### 4. Visual Analytics

#### Charts and Visualizations
1. **Daily New Customer Trend**: Line chart showing daily new customer acquisition and revenue
2. **Customer Type Distribution**: Pie chart of new vs returning customers
3. **Revenue by Customer Type**: Pie chart showing revenue split
4. **Comparison Metrics**: Side-by-side comparison cards

#### Tables
- **Top New Customers**: List of highest-spending new customers with:
  - Customer email
  - First order date
  - Number of orders in period
  - Total spend

### 5. Flexible Configuration

#### Time Period Selection
- Last 7 days
- Last 30 days
- Last 90 days
- Last 6 months
- Last year

#### New Customer Window
- 90 days
- 6 months (180 days)
- **12 months (365 days) - Default**
- 24 months (730 days)

#### Client Filtering
- View all clients combined
- Filter by specific WooCommerce store

## Technical Implementation

### Backend (Django)

**Endpoint**: `/api/woocommerce/orders/customer_acquisition/`

**Parameters**:
- `period` (int): Number of days to analyze (default: 30)
- `client_name` (str): Filter by specific client (optional)
- `new_customer_window` (int): Days since last order to consider "new" (default: 365)

**Response Structure**:
```json
{
  "period": 30,
  "new_customer_window": 365,
  "date_range": {
    "start": "2025-09-10T...",
    "end": "2025-10-10T..."
  },
  "overview": {
    "new_customers": 45,
    "returning_customers": 78,
    "total_unique_customers": 123,
    "new_customer_percentage": 36.6,
    "new_customer_revenue": 12500.00,
    "returning_customer_revenue": 18700.00,
    "total_revenue": 31200.00,
    "new_customer_revenue_percentage": 40.1,
    "avg_new_customer_order_value": 277.78,
    "avg_returning_customer_order_value": 239.74
  },
  "cac_metrics": {
    "total_marketing_spend": 0.00,
    "customer_acquisition_cost": 0.00,
    "revenue_per_new_customer": 277.78,
    "cac_payback_ratio": 0.00,
    "note": "Marketing spend data needs to be integrated"
  },
  "growth": {
    "new_customer_growth": 12.5,
    "previous_period": {
      "new_customers": 40
    }
  },
  "trends": {
    "daily": [...]
  },
  "top_new_customers": [...]
}
```

### Frontend (React/TypeScript)

**Component**: `components/woocommerce/CustomerAcquisition.tsx`

**Key Features**:
- Real-time data fetching
- Interactive period and window selection
- Responsive charts using Chart.js
- Formatted currency and date displays
- Error handling and loading states

**Dashboard Integration**:
- Added as "New Customers" tab in WooCommerce Dashboard
- Positioned after "Enhanced" analytics
- Uses UserPlusIcon for tab icon

### API Proxy

**Endpoint**: `pages/api/woocommerce/orders/customer_acquisition.ts`

Proxies requests from frontend to Django backend with proper error handling.

## Use Cases

### For Cordyfresh (and similar clients)
This feature is particularly valuable for clients who care more about:
- **Customer Growth**: Number of new customers acquired
- **CAC**: Cost to acquire each customer
- **Customer Behavior**: How new customers compare to returning ones

Rather than traditional metrics like:
- Total revenue
- ROAS (Return on Ad Spend)

## Future Enhancements

### Planned Integrations
1. **Marketing Spend Integration**:
   - Google Ads API
   - Facebook/Instagram Ads API
   - Other advertising platforms
   
2. **Advanced CAC Analytics**:
   - CAC by channel (SEO, Paid Search, Social, etc.)
   - CAC trends over time
   - CAC vs LTV (Lifetime Value) analysis
   
3. **Cohort Analysis**:
   - New customer retention by cohort
   - Revenue progression of cohorts
   - Cohort-based LTV prediction

4. **Predictive Analytics**:
   - Forecast new customer acquisition
   - Predict customer lifetime value
   - Identify at-risk customers

## Configuration Examples

### Example 1: E-commerce Store with Frequent Purchases
```
Period: 30 days
New Customer Window: 90 days
Rationale: Customers typically order monthly, so 90 days identifies genuinely new/re-engaged customers
```

### Example 2: High-Ticket / Seasonal Business
```
Period: 365 days
New Customer Window: 730 days (24 months)
Rationale: Purchases are infrequent, need longer window to identify patterns
```

### Example 3: Subscription/Recurring Revenue
```
Period: 90 days
New Customer Window: 365 days (12 months - Default)
Rationale: Annual review of customer acquisition with focus on new signups
```

## Best Practices

### For Accurate Analysis
1. **Choose Appropriate Window**: Match the window to your business cycle
2. **Consistent Periods**: Compare similar time periods (e.g., month-to-month)
3. **Seasonal Adjustment**: Consider seasonal variations in acquisition patterns
4. **Data Quality**: Ensure customer emails are captured consistently

### For CAC Optimization
1. **Track by Channel**: Once integrated, monitor CAC per marketing channel
2. **Set Benchmarks**: Establish target CAC based on customer lifetime value
3. **Test and Iterate**: Run experiments to lower CAC while maintaining quality
4. **Monitor Payback**: Track how quickly new customers pay back their acquisition cost

## Support and Maintenance

### Testing the Feature
1. Navigate to `/woocommerce` in the application
2. Click on "New Customers" tab
3. Select a client (e.g., Cordyfresh)
4. Adjust time period and customer window as needed
5. Verify data loads and charts render correctly

### Troubleshooting
- **No data showing**: Check that orders exist with customer emails in the selected period
- **Incorrect customer counts**: Verify the new customer window matches your business model
- **Performance issues**: Consider shorter time periods for large datasets

### Database Queries
The feature uses email-based customer identification:
```python
# Identifying new customers
previous_order_date = queryset.filter(
    billing_email=customer_email,
    date_created__lt=order_date
).aggregate(Max('date_created'))['date_created__max']

# If no previous order or gap >= window → New Customer
is_new = previous_order_date is None or 
         (order_date - previous_order_date).days >= new_customer_window
```

## Credits
- **Feature Request**: Cordyfresh client requirement
- **Implementation Date**: October 10, 2025
- **Default Configuration**: 12-month new customer window



